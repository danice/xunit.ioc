<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <NuGetOutputPath>bin\NuGet\</NuGetOutputPath>
    <NuGetIntermediatePath>$(BaseIntermediateOutputPath)NuGet\</NuGetIntermediatePath>
    <NuGetLibrariesPath>$(NuGetIntermediatePath)lib\net35\</NuGetLibrariesPath>
    <NuGetToolsPath>$(NuGetIntermediatePath)tools\</NuGetToolsPath>
  </PropertyGroup>

  <Target Name="NuGetClean">
    <RemoveDir Directories="$(NuGetOutputPath);$(NuGetIntermediatePath)" />
  </Target>
  
  <Target Name="NuGetPack" DependsOnTargets="Build;NuGetClean">
    <ItemGroup>
      <NuGetLibrary Include="$(OutputPath)$(AssemblyName).dll" />
      <NuGetLibrary Include="$(OutputPath)$(AssemblyName).xml" />
    </ItemGroup>
    
    <Error Condition="'$(NuGetPackageVersion)' == ''" Text="Set the NuGetPackageVersion property" />
    
    <MakeDir Directories="$(NuGetOutputPath);$(NuGetIntermediatePath);$(NuGetLibrariesPath);$(NuGetToolsPath)" />
    <Copy SourceFiles="@(NuGetLibrary)" DestinationFolder="$(NuGetLibrariesPath)" />
    <Copy SourceFiles="@(NuGetTool)" DestinationFolder="$(NuGetToolsPath)" />
    <Copy SourceFiles="@(NuSpec)" DestinationFolder="$(NuGetIntermediatePath)">
      <Output TaskParameter="DestinationFiles" ItemName="NuSpecCopy" />
    </Copy>
    
    <Exec Command="..\.nuget\nuget.exe pack @(NuSpecCopy) -Version $(NuGetPackageVersion) -NonInteractive -OutputDirectory $(NuGetOutputPath)" />
  </Target>
</Project>